# Group C — Time Window Engine

> **群組目標**：提供統一的時間窗口管理與視覺對齊能力  
> **技術範疇**：交易日計算、窗口參數設定、視覺標記  
> **依賴關係**：依賴 Group B（Grid 模式）

---

## 概述

本群組實現「Time Window Engine」核心功能，確保：
- 所有圖表在同一事件視角下顯示
- 時間窗口參數可彈性設定
- 事件日有明確的視覺標記
- 提供預設窗口快速切換

這是「視覺化事件研究」的關鍵技術。

---

## User Stories

### US C-1: 時間窗口參數設定

**As a** 策略研究員  
**I want** 設定事件前後的觀察天數（交易日）  
**So that** 我能夠根據研究需求調整觀察窗口

#### Acceptance Criteria

**AC1 — 窗口參數輸入**
- **Given** 使用者在查詢設定介面
- **When** 輸入 `pre_days=20` 和 `post_days=10`
- **Then** 系統應記錄這些參數並套用至所有圖表

**AC2 — 參數驗證**
- **Given** 使用者輸入窗口參數
- **When** 參數不合理（如負數、超過 200）
- **Then** 應顯示錯誤訊息並阻止查詢執行

**AC3 — 參數持久化**
- **Given** 使用者設定了窗口參數
- **When** 關閉瀏覽器後重新開啟
- **Then** 應恢復上次使用的窗口參數

---

### US C-2: 全 Grid 窗口一致化渲染

**As a** 策略研究員  
**I want** Grid 中所有小圖使用相同的時間窗口尺度  
**So that** 我能夠公平比較不同樣本的事件前後型態

#### Acceptance Criteria

**AC1 — 一致性窗口計算**
- **Given** 設定 pre_days=20, post_days=10
- **When** 渲染 Grid 中的所有圖表
- **Then** 每個圖表都應顯示事件日前 20 根 K 線與事件日後 10 根 K 線

**AC2 — 時間軸對齊**
- **Given** 不同樣本的事件日期不同
- **When** 以事件日為錨點渲染
- **Then** 所有圖表的事件日應在相同的視覺位置（水平中心）

**AC3 — 窗口參數變更即時更新**
- **Given** Grid 已顯示
- **When** 使用者變更窗口參數
- **Then** 所有圖表應立即重新計算並渲染新窗口

---

### US C-3: 事件日標記線顯示

**As a** 策略研究員  
**I want** 在圖表上看到明確的事件日標記線  
**So that** 我能夠清楚識別事件發生的時間點

#### Acceptance Criteria

**AC1 — 垂直標記線**
- **Given** 圖表已渲染
- **When** 系統識別到事件日
- **Then** 應在事件日 K 線位置繪製一條垂直的標記線

**AC2 — 標記線樣式**
- **Given** 事件日標記線已顯示
- **When** 使用者檢視圖表
- **Then** 標記線應有明顯的顏色（如紅色虛線）並帶有「Event」標籤

**AC3 — 小圖與放大圖一致**
- **Given** 使用者點擊小圖放大
- **When** 切換至放大檢視
- **Then** 事件日標記線應在兩種檢視模式下都保持一致顯示

---

### US C-4: 預設窗口快速切換

**As a** 策略研究員  
**I want** 快速切換常用的窗口預設值  
**So that** 我不需要每次都手動輸入參數

#### Acceptance Criteria

**AC1 — 預設選項顯示**
- **Given** 使用者在窗口設定介面
- **When** 檢視可用的預設選項
- **Then** 應顯示至少三組預設：「10/5」、「20/10」、「60/20」

**AC2 — 一鍵切換**
- **Given** 預設選項已顯示
- **When** 使用者點擊「20/10」
- **Then** 系統應立即套用 pre_days=20, post_days=10 並重新渲染

**AC3 — 自訂預設儲存**
- **Given** 使用者設定了自訂窗口參數
- **When** 點擊「儲存為預設」
- **Then** 該參數組合應新增至預設選項列表

---

## 技術備註

- **交易日計算**：需排除週末與台股休市日
- **事件日標記**：使用 TradingView Lightweight Charts 的 Marker API
- **窗口參數**：儲存於 LocalStorage 或 Vuex/Pinia

---

## 依賴關係

- **被依賴於**：Group D（統計需要基於一致窗口）
- **依賴於**：Group B（Grid 模式）、Group A（基礎圖表）
