# Plan Context — [Milestone 名稱]

> **產生時間**：[timestamp]  
> **目標 Milestone**：[MNN-MilestoneName]  
> **來源文件**：[PRD.md, 附加文件清單]  
> **衝突狀態**：[無衝突 / 有衝突（見衝突報告）]

---

## 1. Milestone 範圍摘要

### 1.1 包含的 User Stories

| US ID | 摘要 | 相關設計類別 |
|-------|------|--------------|
| US X-N | [功能摘要] | DM, FL, CF |
| US X-N | [功能摘要] | CF |
| ... | ... | ... |

### 1.2 能力邊界

**本 Milestone 完成後具備的能力**：
- [能力 1]
- [能力 2]
- [能力 3]

**本 Milestone 不涵蓋**：
- [排除項目 1]
- [排除項目 2]

---

## 2. 擷取的設計上下文

> ⚠️ **重要提醒**：以下內容擷取自 PRD 及指定文件，應作為 Plan 階段的設計參考。
> 若與 System Spec 有衝突，請先解決衝突再進行 Plan。

### 2.1 資料模型（DM）

> 來源：[PRD.md#Section, 行 xxx-xxx]

#### Entity: [EntityName]

| 欄位 | 型別 | 必填 | 說明 |
|------|------|------|------|
| field_name | type | ✅/❌ | 欄位描述 |
| ... | ... | ... | ... |

**Validation Rules**：
- [驗證規則 1]
- [驗證規則 2]

**Invariants**：
- [不變量 1]

---

#### Entity: [EntityName2]

<!-- 依需要新增更多 Entity -->

---

### 2.2 流程設計（FL）

> 來源：[PRD.md#Section, 行 xxx-xxx]

#### Flow: [FlowName]

**觸發條件**：[描述]

**流程步驟**：
```
1. [步驟 1]
2. [步驟 2]
   - 若 [條件] → [分支處理]
3. [步驟 3]
4. [完成]
```

**例外處理**：
- [例外情境] → [處理方式]

---

### 2.3 設定規格（CF）

> 來源：[PRD.md#Section, 行 xxx-xxx]

#### 設定區塊：[區塊名稱]

```yaml
# 設定結構範例
區塊名稱:
  欄位1: 預設值         # 說明
  欄位2: 預設值         # 說明
  巢狀區塊:
    子欄位1: 預設值     # 說明
```

**欄位說明**：

| 欄位路徑 | 型別 | 必填 | 預設值 | 說明 |
|----------|------|------|--------|------|
| 區塊.欄位1 | int | ❌ | 10 | [說明] |
| ... | ... | ... | ... | ... |

---

### 2.4 契約定義（CT）

> 來源：[PRD.md#Section 或附加文件]

#### API/契約：[ContractName]

**端點**：`[METHOD] /path`

**Request**：
```json
{
  "field": "type"
}
```

**Response**：
```json
{
  "field": "type"
}
```

**錯誤碼**：

| 錯誤碼 | 說明 |
|--------|------|
| ERR_001 | [說明] |

---

### 2.5 UI 規格（UI）

> 來源：[PRD.md#Section 或附加文件]

<!-- 若無 UI 相關內容，可移除此區段 -->

#### Screen: [ScreenName]

**元件**：
- [元件 1]：[說明]
- [元件 2]：[說明]

**狀態**：
- Loading：[描述]
- Empty：[描述]
- Error：[描述]

---

### 2.6 技術備註（TN）

> 來源：[PRD.md#Section, 行 xxx-xxx]

**技術選型建議**：
- [技術/套件]：[使用原因]
- [技術/套件]：[使用原因]

**風險提醒**：
- [風險 1]：[說明與緩解建議]
- [風險 2]：[說明與緩解建議]

**開發建議**：
- [建議 1]
- [建議 2]

---

## 3. 與 System Spec 比對結果

| 項目 | 類別 | PRD 定義 | System 定義 | 狀態 |
|------|------|----------|-------------|------|
| [Entity/Flow 名] | DM/FL | [摘要] | 尚未定義 | ✅ 擴展 |
| [Entity/Flow 名] | DM/FL | [摘要] | [摘要] | ✅ 一致 |
| [Entity/Flow 名] | DM/FL | [摘要] | [摘要] | ⚠️ 衝突 |
| [Entity/Flow 名] | DM/FL | [摘要] | [摘要] | 🟡 待確認 |

**狀態說明**：
- ✅ **一致**：PRD 與 System 定義相同，可直接使用
- ✅ **擴展**：PRD 新增，System 無對應，非衝突
- 🟡 **待確認**：需人工判斷是否為意圖內變更
- ⚠️ **衝突**：存在不一致，需解決後再進行 Plan（見衝突報告）

---

## 4. Escalation Log（深讀記錄）

| 階段 | 目標位置 | 深讀原因 | 讀取範圍 |
|------|----------|----------|----------|
| Phase 1 | [file:section] | [原因] | N lines |
| Phase 2 | [file:section] | [原因] | N lines |
| ... | ... | ... | ... |

**總深讀次數**：N  
**最小 Context 完成率**：X%（Stage 1 即完成的項目佔比）

---

## 5. Plan 階段使用建議

### 5.1 必須遵循的設計

以下設計已在 PRD 中明確定義，Plan 階段**應沿用**：

1. **資料模型**：§2.1 的 Entity 定義
2. **設定結構**：§2.3 的 YAML 結構
3. **流程設計**：§2.2 的 Flow 定義

### 5.2 可調整的部分

以下設計為建議性質，Plan 階段**可視情況調整**：

1. [可調整項目 1]
2. [可調整項目 2]

### 5.3 特別注意事項

- [注意事項 1]
- [注意事項 2]

---

## 6. 下一步

- [ ] 確認無衝突（或衝突已解決）
- [ ] 執行 `/speckit.plan` 開始規劃
- [ ] 在 plan.md 中引用本文件的設計上下文
