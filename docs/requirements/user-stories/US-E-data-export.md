# Group E — 資料匯出功能

> **群組目標**：提供研究結果匯出能力  
> **技術範疇**：Excel 報表產生、資料序列化  
> **依賴關係**：依賴 Group D（統計數據）

---

## 概述

本群組實現「研究成果輸出」功能，讓研究員能夠：
- 將查詢結果、圖表樣本清單與績效統計匯出為 Excel
- 報表包含完整的查詢條件與時間戳記，確保可追溯性
- 支援後續進一步分析或報告撰寫

---

## User Stories

### US E-1: Excel 報表匯出

**As a** 策略研究員  
**I want** 將目前的研究結果匯出為 Excel 檔案  
**So that** 我能夠保存研究成果或進行進一步分析

#### Acceptance Criteria

**AC1 — 匯出按鈕顯示**
- **Given** Grid 模式已顯示樣本與績效統計
- **When** 使用者檢視績效面板
- **Then** 應顯示「匯出 Excel」按鈕

**AC2 — Excel 結構 - 查詢條件工作表**
- **Given** 使用者點擊匯出按鈕
- **When** 系統產生 Excel 檔案
- **Then** 第一個工作表「查詢條件」應包含：查詢 SQL/條件、時間窗口參數、查詢時間戳記

**AC3 — Excel 結構 - 樣本清單工作表**
- **Given** 系統產生 Excel 檔案
- **When** 使用者開啟檔案
- **Then** 第二個工作表「樣本清單」應包含：股票代碼、股票名稱、事件日期、事件日收盤價

**AC4 — Excel 結構 - 績效統計工作表**
- **Given** 系統產生 Excel 檔案
- **When** 使用者開啟檔案
- **Then** 第三個工作表「績效統計」應包含：樣本數量、各觀察期的平均報酬/勝率/最大回撤

**AC5 — Excel 結構 - 績效明細工作表**
- **Given** 系統產生 Excel 檔案
- **When** 使用者開啟檔案
- **Then** 第四個工作表「績效明細」應包含：每個樣本的個別報酬明細（與 US D-4 明細表相同）

**AC6 — 檔案命名**
- **Given** 系統產生 Excel 檔案
- **When** 瀏覽器下載檔案
- **Then** 檔名應為 `ASSRP_研究結果_YYYYMMDD_HHMMSS.xlsx`

**AC7 — 大量樣本匯出效能**
- **Given** 查詢結果包含 500+ 個樣本
- **When** 使用者點擊匯出
- **Then** Excel 產生時間應在 10 秒內完成

**AC8 — 匯出錯誤處理**
- **Given** 匯出過程中發生錯誤（如後端逾時）
- **When** 系統嘗試產生 Excel
- **Then** 應顯示錯誤訊息並提供重試選項

---

## 技術備註

- **後端實作**：使用 Python `openpyxl` 或 `xlsxwriter` 產生 Excel
- **資料來源**：從績效統計 API response 取得完整資料
- **檔案大小**：需考慮大量樣本時的檔案大小限制（建議 < 10MB）

---

## 依賴關係

- **被依賴於**：無（終端功能）
- **依賴於**：Group D（績效統計）、Group B（樣本清單）、Group C（窗口參數）
