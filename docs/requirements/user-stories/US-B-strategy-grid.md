# Group B — Strategy Grid 模式

> **群組目標**：提供批次策略掃描與多圖並列檢視能力  
> **技術範疇**：條件查詢、Grid 佈局、事件置中渲染  
> **依賴關係**：依賴 Group A（基礎繪圖）

---

## 概述

本群組實現「Strategy Grid Mode」的核心功能，讓研究員能夠：
- 透過結構化條件查詢符合條件的樣本
- 以 Grid 佈局並列顯示多個圖表
- 將事件日置中對齊，方便視覺比較
- 管理大量查詢結果的顯示

---

## User Stories

### US B-1: 結構化條件查詢

**As a** 策略研究員  
**I want** 透過結構化條件篩選符合特定型態的股票樣本  
**So that** 我能夠找到符合研究假設的事件案例

#### Acceptance Criteria

**AC1 — 基礎條件輸入**
- **Given** 使用者在查詢介面
- **When** 輸入股票代碼、日期範圍、價格範圍等條件
- **Then** 系統應產生對應的 SQL 查詢並執行

**AC2 — 條件邏輯組合**
- **Given** 使用者設定多個條件
- **When** 使用 AND/OR 邏輯組合條件
- **Then** 系統應正確解析並執行複合查詢

**AC3 — 查詢結果預覽**
- **Given** 查詢執行完成
- **When** 系統取得結果
- **Then** 應顯示符合條件的樣本數量與基本資訊（股票代碼、事件日期）

**AC4 — 無結果處理**
- **Given** 查詢條件過於嚴格
- **When** 查詢結果為空
- **Then** 應顯示「無符合條件的樣本」提示,並建議放寬條件

---

### US B-2: Grid 多圖並列顯示

**As a** 策略研究員  
**I want** 以 4x5 或更多的 Grid 佈局同時檢視多個樣本  
**So that** 我能夠快速批次比較不同樣本的型態

#### Acceptance Criteria

**AC1 — Grid 佈局渲染**
- **Given** 查詢取得多個樣本（如 20 個）
- **When** 切換到 Grid 模式
- **Then** 應以 4x5 Grid 佈局顯示所有小圖

**AC2 — Grid 尺寸可調整**
- **Given** Grid 模式已啟動
- **When** 使用者調整 Grid 行列數（如改為 5x4）
- **Then** Grid 應重新排列,每個小圖尺寸相應調整

**AC3 — 高效能渲染**
- **Given** Grid 包含大量小圖（如 50+）
- **When** 系統渲染 Grid
- **Then** 渲染時間應在 3 秒內完成,不應出現明顯卡頓

**AC4 — 小圖資訊標籤**
- **Given** 每個小圖已渲染
- **When** 使用者檢視 Grid
- **Then** 每個小圖應顯示股票代碼與事件日期標籤

---

### US B-3: 事件日置中對齊

**As a** 策略研究員  
**I want** 所有 Grid 小圖的事件日都置中對齊  
**So that** 我能夠直觀比較事件前後的價格型態

#### Acceptance Criteria

**AC1 — 事件日居中計算**
- **Given** 每個樣本有明確的事件日期
- **When** 系統計算圖表顯示範圍
- **Then** 事件日應位於圖表的水平中心位置

**AC2 — 事件前後資料對稱**
- **Given** 設定事件前 20 日、事件後 10 日
- **When** 渲染圖表
- **Then** 事件日左側應顯示 20 根 K 線,右側顯示 10 根 K 線

**AC3 — 資料不足時的處理**
- **Given** 某樣本的事件前或事件後資料不足
- **When** 系統嘗試渲染
- **Then** 應顯示實際可用資料,並標記「資料不完整」

---

### US B-4: 查詢結果數量限制與分頁

**As a** 策略研究員  
**I want** 查詢結果數量過多時能分頁檢視  
**So that** 系統效能不會因大量資料而降低

#### Acceptance Criteria

**AC1 — 單次載入數量限制**
- **Given** 查詢結果超過 100 個樣本
- **When** 系統載入 Grid
- **Then** 應一次只載入前 100 個樣本,並提示還有更多結果

**AC2 — 分頁導航**
- **Given** 查詢結果已分頁
- **When** 使用者點擊「下一頁」或輸入頁碼
- **Then** 應載入對應頁次的樣本並更新 Grid

**AC3 — 分頁狀態顯示**
- **Given** 查詢結果已分頁
- **When** 使用者檢視 Grid
- **Then** 應顯示當前頁次與總頁數（如「第 1/5 頁」）

---

## 技術備註

- **Grid 渲染**：需考慮 Virtual Scrolling 或 Lazy Loading
- **事件置中演算法**：基於交易日計算,非日曆日
- **查詢效能**：複雜條件查詢需適當建立索引

---

## 依賴關係

- **被依賴於**：Group C（Time Window 需要 Grid 顯示）、Group D（統計需要 Grid 樣本）
- **依賴於**：Group A（基礎圖表能力）
